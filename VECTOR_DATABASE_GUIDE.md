# 🧠 向量数据库详解 - AI文档问答系统

## 📊 什么是向量数据库？

向量数据库是一种**特殊的数据库**，它将文本转换为**高维向量**（数字数组），通过计算向量之间的**相似度**来找到相关内容。

## 🔍 工作流程详解

### 1️⃣ 文本处理阶段
```
PDF文档 → 文本提取 → 文本分块 → 向量化 → 存储索引
```

- **文本分块**：将长文档分割成512-1024字符的小片段
- **向量化**：使用OpenAI的`text-embedding-3-small`模型
- **维度**：每个文本块转换为1536维的向量

### 2️⃣ 搜索阶段
```
用户问题 → 向量化 → 相似度计算 → 返回最相关片段
```

## 💾 存储位置

### 📁 内存存储（运行时）
- **FAISS索引**：存储在内存中，程序重启后需要重新创建
- **向量维度**：1536维（OpenAI embedding模型）
- **相似度算法**：余弦相似度（Cosine Similarity）

### 📁 文件存储（持久化）
```
F:
└── AI_langchain/
    ├── cache/
    │   ├── text/           # 文本缓存
    │   │   └── *.cache     # 问答历史缓存
    │   ├── vector/         # 向量缓存（预留）
    │   └── metadata/       # 会话元数据
    ├── docs/               # 原始PDF文档
    └── uploads/            # 用户上传的PDF
```

## 🎯 实际存储示例

### 当前存储状态：
- **文本缓存**：4个文件，包含问答历史
- **向量索引**：运行时创建，重启后重新生成
- **PDF文档**：1个示例文档（`docs/sample.pdf`）

### 向量化过程示例：
```python
# 原始文本：
"数据结构是计算机存储、组织数据的方式"

# 向量化后：
[0.0234, -0.0156, 0.0891, ..., 0.0342]  # 1536个数字
```

## 🔧 如何查看向量数据

### 方法1：使用存储查看器
```bash
python storage_viewer.py
```

### 方法2：直接查看文件
```bash
# 查看缓存目录
ls cache/text/
ls cache/vector/

# 查看PDF文档
ls docs/
ls uploads/
```

### 方法3：通过Web界面
在系统启动后，查看"系统状态"标签页

## 📈 性能特点

| 特性 | 说明 |
|------|------|
| **搜索速度** | 毫秒级响应 |
| **存储效率** | 每1000个文本片段约占用50MB |
| **准确性** | 基于语义相似度，而非关键词匹配 |
| **扩展性** | 支持数千个文档 |

## 🔄 数据生命周期

1. **首次启动**：读取PDF → 创建向量索引 → 存储到内存
2. **问答过程**：缓存问题和答案到文本缓存
3. **重启系统**：重新读取PDF → 重新创建向量索引
4. **清理缓存**：可手动清理cache目录

## 🚨 注意事项

- **向量索引**：重启后需要重新创建（这是正常的）
- **文本缓存**：问答历史会保留，避免重复计算
- **PDF文档**：原始文件始终保留在docs/和uploads/目录
- **存储空间**：随着文档增加，内存使用会线性增长

## 💡 优化建议

1. **持久化向量索引**：未来可保存到磁盘，避免重启重建
2. **增量更新**：只处理新上传的文档
3. **缓存策略**：定期清理过期缓存
4. **分布式存储**：支持多台服务器共享向量索引

## 🔍 调试工具

运行以下命令查看详细存储信息：
```python
# 在Python中查看
from src.core.pdf_processor import PDFProcessor
processor = PDFProcessor()
print("文档片段数:", len(processor.process_pdf("docs/sample.pdf")))
```